<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:c="http://java.sun.com/jstl/core"
	  xmlns:fn="http://java.sun.com/jsp/jstl/functions"   
	  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"	  
      xmlns:t="http://myfaces.apache.org/tomahawk"
	  xmlns:crud="http://www.googlecode.com/crank/crud"
	  xmlns:crank="http://www.googlecode.com/crank"	
      >

  <ui:composition>

  	<c:if test="${empty ajax}">
  		<c:set var="ajax" value="true"/>
  	</c:if>

  	<c:if test="${empty cancelAlwaysOn}">
  		<c:set var="cancelAlwaysOn" value="true"/>
  	</c:if>

  	<c:if test="${empty hideCancel}">
  		<c:set var="hideCancel" value="false"/>
  	</c:if>

  	<c:if test="${empty detail}">
  		<c:set var="detail" value="false"/>
  	</c:if>

  	<c:if test="${empty formButtonClass}">
  		<c:set var="formButtonClass" value="paginationGroupButton"/>
  	</c:if>
  	
  	<c:if test="${empty rendered}">
  		<c:set var="rendered" value="true"/>
  	</c:if>

	<c:when test="${ajax}">
		<c:set var="reRender" value="${reRender},buttons${id}" />
	</c:when>
	
	<c:set var="addCreateMode" value="${(crud.state=='ADD') or (crud.state == null) or (crud.state=='UNKNOWN')}" />
	<c:set var="editMode" value="${(crud.state=='EDIT')}" />
	<!--<c:set var="entityName" value="${crud:createLabel(crud.name)}" />-->
	
	<c:if test="${detail}">
		<c:set var="entityName" value="${crud.name}_${crud.relationshipManager.childCollectionProperty}" />
	</c:if>
	
	<c:if test="${not detail}">
		<c:set var="entityName" value="${crud.name}" />
	</c:if>
	
	<c:set var="pNames" value="${fn:split(propertyNames, ',')}" />
	
	
	
		<h:panelGrid id="formLayout${id}" columns="1" rendered="${rendered and ((crud.state=='ADD') or (crud.state == 'EDIT'))}">
			<!-- Main for fields -->
		    <h:panelGrid columns="3" rowClasses="formRowClass1, formRowClass2" columnClasses="topLeft">
				<c:forEach items="${pNames}" var="property">
					<crank:field entity="#{crud.entity}" crud="${crud}" type="${crud.entityClass}" fieldName="${property}" entityName="${entityName}"/>
				</c:forEach>			
		    </h:panelGrid>
					    
			<!-- Enabled / Disabled Toggle Groups (javascript version) -->
			<c:if test="${not empty enableGroups}">
				<c:set var="enGroups" value="${fn:split(enableGroups, ',')}" />
			    <h:panelGrid columns="1" rowClasses="radioGroup" cellspacing="5" width="100%">
					<c:set var="counter" value="0"/>
					<c:forEach items="${enGroups}" var="group">
						<c:set var="groupId" value="${entityName}enGroup${counter}"/>
						<c:set var="enableItems" value="${fn:split(group, ':')}"/>
						<c:set var="i" value="0"/>
						<c:set var="disabledDefault" value="${false}"/>
						<h:panelGrid columns="3" columnClasses="topLeft">
							<c:forEach items="${enableItems}" var="enableItem">
							
								<c:choose>
									<c:when test="${i == 0}">
							
										<crank:field 
											fieldId="${groupId}${enableItem}"
										    onclick="setEnableGroup('${parentForm}','${enableItem}','${groupId}');"
											crud="${crud}" 
											entity="${crud.entity}" 
											type="${crud.entityClass}" 
											fieldName="${enableItem}" 
											entityName="${entityName}"/>
										<c:set var="disabledDefault" value="${not crud.entity[enableItem]}"/>
									</c:when>
									<c:otherwise>

										<crank:field 
											fieldId="${groupId}${enableItem}"
											disabled="${disabledDefault}"
											crud="${crud}" 
											entity="${crud.entity}" 
											type="${crud.entityClass}" 
											fieldName="${enableItem}" 
											entityName="${entityName}"/>

									</c:otherwise>
								</c:choose>
								
								<c:set var="i" value="${i + 1}"/>
									
							</c:forEach>
						</h:panelGrid>
						<c:set var="counter" value="${counter + 1}"/>
					</c:forEach>	
			    </h:panelGrid>
			</c:if>
					    
			<!-- Radio Groups -->
			<c:if test="${not empty exclusiveGroups}">
				<c:set var="eGroups" value="${fn:split(exclusiveGroups, ',')}" />
			    <h:panelGrid columns="1" rowClasses="radioGroup" cellspacing="5" width="100%">
					<c:set var="counter" value="0"/>
					<c:forEach items="${eGroups}" var="group">
						<c:set var="groupId" value="${entityName}Group${counter}"/>
						<c:set var="exclusiveBoxes" value="${fn:split(group, ':')}"/>
						<h:panelGrid columns="3" columnClasses="topLeft">
							<c:forEach items="${exclusiveBoxes}" var="exclusiveField">
							    <c:if test="${crud:isBoolean(crud.entityClass,exclusiveField)}">
									<crank:field 
										fieldId="${groupId}${exclusiveField}"
									    onclick="setExclusiveGroup('${parentForm}','${exclusiveField}','${groupId}',false);"
										entity="#{crud.entity}" 
										type="${crud.entityClass}" 
										crud="${crud}" 
										fieldName="${exclusiveField}" 
										entityName="${entityName}"/>
								</c:if>
							</c:forEach>
						</h:panelGrid>
						<c:set var="counter" value="${counter + 1}"/>
					</c:forEach>	
			    </h:panelGrid>
			</c:if>
					    
		    <ui:insert/>
			<a4j:outputPanel ajaxRendered="true">
		    
		    <h:panelGrid id="buttonsPlain${id}" columns="4" rendered="${not ajax}">
				<h:commandButton
					id="createPlainB${id}" 
					rendered="${(crud.state=='ADD') or (crud.state == null) or (crud.state=='UNKNOWN')}"
					styleClass="${formButtonClass}" 
					value="Create" 
					action="${crud.create}"/>			
				<h:commandButton 
					id="updatePlainB${id}" 
					rendered="${(crud.state=='EDIT')}" 
					styleClass="${formButtonClass}" 
					value="Update" 
					action="${crud.update}"/>			
				<h:commandButton 
				    id="resetPlainB${id}"
					value="Reset"
					styleClass="${formButtonClass}" 
					type="reset"/>
				<h:commandButton 
					id="cancelPlainB${id}" 
					value="Cancel"
					rendered="${((crud.state=='ADD') or (crud.state == 'EDIT') or (cancelAlwaysOn)) and not hideCancel }"
					styleClass="${formButtonClass}" 
					action="${crud.cancel}"/>			
			</h:panelGrid>
			
		    <h:panelGrid id="buttons${id}" columns="4" rendered="${ajax}">
			    	  
				<a4j:commandButton 
					id="createAjaxB${id}" 
					rendered="${addCreateMode}"
					reRender="${reRender}" 
					styleClass="${formButtonClass}"
					value="Create" 
					action="${crud.create}"/>		
				<a4j:commandButton 
					id="updateAjaxB${id}" 
					rendered="${editMode}" 
					reRender="${reRender}" 
					styleClass="${formButtonClass}" 
					value="Update" 
					action="${crud.update}"/>			
				<a4j:commandButton 
					id="resetAjaxB${id}" 
					value="Reset"
					reRender="${reRender}" 
					styleClass="${formButtonClass}" 
					type="reset"/>
				<a4j:commandButton 
					id="cancelAjaxB${id}" 
					value="Cancel"
					immediate="true"
					rendered="${((crud.state=='ADD') or (crud.state == 'EDIT') or (cancelAlwaysOn)) and not hideCancel }"
					reRender="${reRender}" 
					styleClass="${formButtonClass}" 
					type="button"
					action="${crud.cancel}"/>

			</h:panelGrid>
			</a4j:outputPanel>
		</h:panelGrid>
		

</ui:composition>

</html>

