<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core" 
      xmlns:arc="http://www.arc-mind.com/jsf/core" 
      xmlns:c="http://java.sun.com/jstl/core"
	  xmlns:fn="http://java.sun.com/jsp/jstl/functions"   
      xmlns:t="http://myfaces.apache.org/tomahawk"
	  xmlns:crank="http://www.googlecode.com/crank"
	  xmlns:crud="http://www.googlecode.com/crank/crud"
	  xmlns:validation="http://code.google.com/p/krank/validation"
      >

  <ui:composition>

	<c:if test="empty type">
		    <c:set var="type" value="${crud.entityClass}" />
	</c:if>
	<c:if test="${empty formLabelStyleClasses}">
	    <c:set var="formLabelStyleClasses" value="fieldLabel" />
	</c:if>


	<c:if test="${empty formFieldStyleClasses}">
	    <c:set var="formFieldStyleClasses" value="fieldField" />
	</c:if>

    <!--  The label is optional. Generate it if it is missing. -->
	<c:if test="${empty label}">
	    <c:set var="label" value="${crud:createLabel(fieldName)}" />
	</c:if>

    <!-- The required attribute is optional, 
         initialize it to true if not found. -->
    <c:if test="${empty required}">
        <c:set var="required" value="${crud:isRequired(type,fieldName)}" />
    </c:if>
    
	<c:if test="${empty idStub}">
	    <c:set var="idStub" value="${crud:replace(fieldName, '.', '_')}${crud.name}Field" />
	</c:if>
    

   <h:outputLabel id="${idStub}OutputLabelId" value="${label}" 
   				  for="${idStub}Id" styleClass="${formLabelStyleClasses}"/>

   <c:if test="${crud:isText(type,fieldName)}">
   	   <c:if test="${crud:isLargeText(type,fieldName)}">
		   <h:inputTextarea id="${idStub}Id" 
		                     value="#{entity[fieldName]}" 
		                     required="${required}" 
		                     styleClass="${formFieldStyleClasses}"
		                     cols="50"
		                     rows="${crud:textSize(type,fieldName)/50}">
		            <validation:validateBasedOnMetaData formClass="${type}" fieldName="${fieldName}"/>
		            <c:if test="${crud:textSize(type,fieldName)>0}">
		            	<f:validateLength maximum="${crud:textSize(type,fieldName)}" />
		            </c:if>
		            <ui:insert />
		   </h:inputTextarea>
   	   </c:if>
   	   <c:if test="${not crud:isLargeText(type,fieldName)}">
		   <h:inputText id="${idStub}Id" 
		                     value="#{entity[fieldName]}" 
		                     required="${required}" 
		                     styleClass="${formFieldStyleClasses}">
		            <validation:validateBasedOnMetaData formClass="${type}" fieldName="${fieldName}"/>
		            <c:if test="${crud:textSize(type,fieldName)>0}">
		            	<f:validateLength maximum="${crud:textSize(type,fieldName)}" />
		            </c:if>
		            <ui:insert />
		   </h:inputText>
   	   </c:if>
   </c:if>


    <!--  If the value binding is a boolean, display a
           selectBooleanCheckbox field. -->
    <c:if test="${crud:isBoolean(type,fieldName)}">
	   <h:selectBooleanCheckbox  id="${idStub}Id" 
						 value="#{entity[fieldName]}" 
						 required="${required}" 
						 styleClass="fieldSelectBooleanCheckbox"
						 />
	</c:if>

    <!--  If the value binding is a date, 
          display a t:inputDate field. -->
    <c:if test="${crud:isDate(type,fieldName)}">
		<t:calendar id="${idStub}Id" 
					   renderPopupButtonAsImage="true" 
	                   renderAsPopup="true" value="#{entity[fieldName]}" 
	                   required="${required}"
	                   styleClass="${formFieldStyleClasses}">
		          <validation:validateBasedOnMetaData formClass="${type}" fieldName="${fieldName}"/>
	              <ui:insert />
		</t:calendar>
	</c:if>

    <c:if test="${crud:isManyToOne(type,fieldName)}">
        <c:set var="propEntityName" value="${crud:getPropertyEntityName(type,fieldName)}" />
		<crud:select id="${idStub}Id" 
		              value="#{entity[fieldName]}">
		    <validation:validateBasedOnMetaData formClass="${type}" fieldName="${fieldName}"/>		              
			<f:selectItems id="${idStub}SelectItemsId" value="${selectItemGenerators[propEntityName].list}" />
			<f:converter converterId="" binding="${converters[propEntityName]}"/>
		</crud:select>    	
    </c:if>
    
    <c:if test="${crud:isFile(type,fieldName)}">
        <c:set var="mapKeyName" value="uploadFile_${fieldName}" />
        <t:inputFileUpload id="fileupload"
                               accept="image/*"
                               value="${crud.dynamicProperties[mapKeyName]}"
                               storage="file"
                               maxlength="${crud:columnSize(type,fieldName)}"/>
    </c:if>

    

    <!--  Display any error messages that are found -->
    <h:panelGroup id="${idStub}ErrorId">
	    <div id="${fieldName}Error"/>
    	<h:message 
	    	   id="${idStub}MessageId" 
    		   styleClass="fieldMessage"
    		   style="color: red; text-decoration: underline" 
               for="${idStub}Id" />
    </h:panelGroup>

</ui:composition>

</html>

