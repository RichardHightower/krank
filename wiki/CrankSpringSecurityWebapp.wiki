#summary Crank Spring Security Webapp is a direct copy of the crank-crud-webapp in the 'examples/' folder , and it has been modified to integrate JSF/Facelets with Spring Security 2.0.4
#labels examples,springsecurity

= Introduction =

The Crank Spring Security Webapp is a mini-example application that utilizes Spring Security 2.x.x to enforce user logins to secured resources. Out of the box, Spring Security 2.x.x does not integrate at all with JSF, so a little code had to be written so that it would. By default if you use Spring Security's JDBC Authentication Provider, Spring assumes that you have certain table names and columns defined to do out of the box authentication with a database. You can define your own tables and authentication queries, but out of the box, Spring has nailed down a pretty good ERD for the way they have implemented the basic concepts of Security which are Users, Roles, Groups, etc... Spring Security has no concept of a User Management UI, so that will be something to be added in the near future. (Acegi lacked one as well)

For a more deta0led explanation of the internals of Spring Security 2 you can visit the following links :
  # [http://static.springframework.org/spring-security/site/ Spring Security Documentation]
  # [http://static.springsource.org/spring-security/site/reference/html/appendix-schema.html Spring Security Database Schema Explained]

I highly recommend reading the links provided, it will save you a lot of headache. 
 
= Brief =
The crank-spring-security-webapp is a direct copy of the crank-crud-webapp example with the exception of a few changes:

  * Custom Crank Spring Security tag library code (_Spring Security tag libraries do not work with Java Server Faces without a custom tag library and supporting classes_)
  * modified .xhtml pages to include Crank Spring Security tag namespaces
  * Spring Security application context configuration file.
  * web.xml Spring Security Listeners
  * pom.xml Spring Security library additions
  * Additional employee-jpa-model classes added to support the assumed default Spring Security Database Schema

So with that being said, let's examine and explain the changes.

= Integrating Spring Security 2.0.4 and Crank 1.0.4 =
=== POM Additions ===
  # Spring Security 2.0.4 Core Libraries
{{{
<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-core</artifactId>
    <version>2.0.4</version>
</dependency>

<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-core-tiger</artifactId>
    <version>2.0.4</version>
</dependency>

<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-acl</artifactId>
    <version>2.0.4</version>
</dependency>
}}}
  # Spring Security 2.0.4 currently only works with [http://www.springsource.org/javaconfig Spring JavaConfig Milestone 2]
{{{
<!-- start javaconfig -->
        <dependency>
            <groupId>org.springframework.javaconfig</groupId>
            <artifactId>spring-javaconfig</artifactId>
            <version>1.0-m2</version>
            <exclusions>
                <exclusion>
                    <groupId>asm</groupId>
                    <artifactId>asm-commons</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.springframework</groupId>
                    <artifactId>spring-support</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.aopalliance</groupId>
                    <artifactId>aopalliance</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.springframework</groupId>
                    <artifactId>spring-web</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.springframework</groupId>
                    <artifactId>spring-webmvc</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.springframework</groupId>
                    <artifactId>spring</artifactId>
                </exclusion>
                <exclusion>
                    <groupId>org.springframework</groupId>
                    <artifactId>spring-aop</artifactId>
                </exclusion>
            </exclusions>
        </dependency>
        <!-- end javaconfig-->
}}}
  # Custom Crank Spring Security Tag Dependency
{{{
   <dependency>
     <groupId>javax.el</groupId>
     <artifactId>el-api</artifactId>
     <version>1.0</version>
    <scope>provided</scope>            
   </dependency>
}}}

=== Spring Security Application Context Configuration ===
A configuration file named "_applicationContext-security.xml_" was added to web.xml under the WEB-INF/ folder. It could have been added as a separate namespace configuration within the Spring Context configuration file, but this is much cleaner.

*web.xml addition*
{{{
<context-param>
 <param-name>contextConfigLocation</param-name>
  <param-value>
    classpath:/applicationContext.xml
    /WEB-INF/applicationContext-security.xml <!-- ADDED FILE -->
  </param-value>
</context-param>
}}}

*applicationContext-security.xml added to WEB-INF/*
{{{
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:s="http://www.springframework.org/schema/security"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-2.0.1.xsd">



    <s:http auto-config="false" once-per-request="false"  access-denied-page="/accessDenied.jsf">

        <s:intercept-url pattern="/pages/crud/Users/**" access="ROLE_USER,ROLE_SUPERVISOR"/>
        <s:intercept-url pattern="/login.jsf*" filters="none"/>
		<s:form-login login-page="/login.jsf"
                      authentication-failure-url="/accessDenied.jsf"
                      default-target-url="/index.jsp"/>
        
		<s:logout logout-url="/logout" logout-success-url="/"></s:logout>
        <s:concurrent-session-control max-sessions="1" exception-if-maximum-exceeded="true"/>
    </s:http>


    <s:authentication-provider user-service-ref='myUserDetailsService'/>
    <!--<s:authentication-provider>-->

        <!--<s:jdbc-user-service data-source-ref="employeeDataSource"-->
                             <!--authorities-by-username-query="select username,authority from users where username=?"/>-->
        <!--<s:jdbc-user-service data-source-ref="employeeDataSource"/>-->
                <!---->


    <!--</s:authentication-provider>-->



</beans>
}}}